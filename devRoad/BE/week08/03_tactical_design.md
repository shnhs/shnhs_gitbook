# Tactical Design

이전에 설명한 전략적 설계는 DDD 패턴으로 소프트웨어를 개발하는데 아주 중요한 내용이다.\
특히 소프트웨어의 개발 규모가 커질 수록 더욱 중요해 진다.

'규모가 클 수록' 이라는 특성?에 따라서 지금 당장 다룰 수 있는 주제는 아니다.\
정말 실무에서 팀 단위로 논의되어야 할 내용이지\
DDD에 대한 이해 및 작은 규모의 설계와 코드 레벨에서는 다루기가 힘들다.

개인이 혼자 이해하고 작성할 수 있을 작은 설계와 코드 단위에서는\
전술적 설계를 더욱 깊게 고민해봐야 할 것이다.

전략적 설계 혹은 Context 분리 등을 통해서 적절한 도메인 모델을 구분할 수 있을 것이다. 그렇게 나누어진 ‘모메인 모델’을 개발과정에서 설계 및 실제 코드 작성에 반영하면 된다. 이를 `모델 주도 설계(Model Driven Design)` 라고도 한다.

도메인 모델은 아래와 같은 대표적으로 아래와같은 패턴들로 구성할 수 있다. (이전에 한번 씩 정리하거나 다뤄본 개념들이기도 하다)

## 1. Entity

간단하게 한문장으로 정의한다면 엔티티란\
식별자(identifier)로 구분될 수 있는 객체 를 말한다.

각 객체를 구분지을 수 있는 고유한 식별자(숫자ID, String 일련번호 등)을 가지며\
그 식별자로 두 객체 동일한지 를 확인 할 수 있는것이 바로 엔티티 이다.

ERD 같은 개념에서 사용하는 Entity와는 다름 개념임을 구분하도록 하자.

## 2. Value Object

바로 위에서 설명한 엔티티와는 다르게 식별성이 중요하지 않고,\
어떤 속성을 가지는지가 중요한 객체가 바로 Value Object; VO 이다.

VO는 속성을 통해 동등성을 체크한다. 엔티티와 다르게 동일성을 확인하지 않음을 유의하자\
따라서 코드적인 측면에서 보았을 때 VO를 구현하려면\
클래스 내부에 Equals 메서드를 재정의하여 사용해야 한다.

가장 쉽게 와닿는 것이 바로 돈이라는 개념일 것이다.\
물론 지폐와 같은 객체를 디테일 하게 구현하고 혹은 필요에 의해서\
일련번호 같은 식별자를 가지게 될 수도 있지만,\
대부분의 경우에 돈은 그 값이 중요하다.

여기 있는 만원과 저기 있는 만원은, 만원이라는 값만 동일하다면 상관없이 같은 value를 가진다.

## 3. Aggregate

앞의 Entity와 VO는 사실상 Aggregate의 구성요소가 되는 개념들이라고 봐도 좋을 것이다.\
Aggregate는 어떤 모델(도메인)에서 가지는 연관 객체의 묶음을 의미한다.

비유를 사용하자면 Entity와 VO는 마치 자동차에서 타이어나 엔진 같은것이고,\
그런 부품들이 모여서 만들어진 자동차가 우리가 직접 사용할 Aggregate와 같은 개념이 될 것이다.

Aggregate는 불변식을 유지하고 여러 도메인 객체를 사용하기 좋게 만들어준다.\
여기서 불변식이란 어떤 도메인에서 지켜야할 제약조건, 규칙이라고 생각하면 된다.



예를들어 주문이라는 예시를 생각해보자

주문은 ID라는 식별자를 가지고 담겨있는 아이템 리스트라는 속성을 가진다.\
이때 담긴아이템의 가격을 합쳐 100만원 이하라는 제약(불변식)을 가진다고 고려하자

만약 아이템을 개별적으로 추가하고 빼고 하다보면\
동시에 아이템 리스트에 접근하는 경우 가격의 총합이 100만원을 넘칠 수 있다. 즉 불변식이 깨질 수 있게 된다.

상식적?이게도 이런 경우를 막기위해서 주문단위에서 가격계산을 해야함을\
바로 생각할 수 있을 것이다.

주문 이라는 `Root Aggregate`를 기준으로 하나에 객체에 동시에 접근할 수 없도록 만들어야 한다.\
이를 DB관련 측면에서 보면 트랜잭션 관리를 하면 될 것이다.\
트랜잭션 관리 등을 통해 불변식을 지키면서 객체를 변경하도록 하는것이 중요하다.



## 4. Repository

도메인 객체를 저장하고 읽어 오는 객체를 의미 한다라고 이해하면 편할 것 같다.\
모든 도메인 객체가 Repository를 가지는 것은 아니고 오직 Aggergate 만 Repository를 가지게 된다.

Spring Data JPA가 Repository를 쉽게 구현하고 사용할 수 있도록 여러 기능을 제공하기 때문에,\
DDD 에서 가장 보편적으로 사용된다.
